{
	"id": "198820b1-dba4-45be-8c9d-3ae60e4d35e5",
	"createdAt": "2022-08-01T21:07:53.049Z",
	"createdBy": "VSawan10",
	"globalScripts": [],
	"externalModules": [
		{
			"id": "e97de24d-bb2f-4ffb-8a6a-53df30810cb6",
			"name": "json-rules-engine",
			"contextname": "jsonrulesengine",
			"path": "/app/tmp/node_modules/json-rules-engine"
		}
	],
	"entitySets": [],
	"apis": [],
	"name": "OSS_FETCH_SALARY_OFFER",
	"ver": "22.8.4.1619",
	"description": null,
	"content": [
		"==OBJECT STRING==",
		"async function fetch_salary_offer() {\r",
		"\r",
		"\r",
		"    try {\r",
		"\r",
		"        let startTime = Date.now();\r",
		"\r",
		"\r",
		"        //input parameters\r",
		"        let yearsDiff = 3//req.body.yearsDiff ? req.body.yearsDiff : '';\r",
		"        let hireType = 'EXTERNAL'//req.body.hireType ? req.body.hireType : '';\r",
		"        let avgSalary = 135789//req.body && req.body.avgSalary ? req.body.avgSalary : ''\r",
		"\r",
		"        let errStatus = false;\r",
		"        let errMsg = [];\r",
		"\r",
		"\r",
		"        if (yearsDiff === '') {\r",
		"            errStatus = true;\r",
		"            errMsg.push('\\n Difference of Years of Experience')\r",
		"        }\r",
		"        if (hireType.trim() === '') {\r",
		"            errStatus = true;\r",
		"            errMsg.push('\\n Hire Type')\r",
		"        }\r",
		"        if (avgSalary === '') {\r",
		"            errStatus = true;\r",
		"            errMsg.push('\\n Average Salary')\r",
		"        }\r",
		"\r",
		"\r",
		"        /*\r",
		"        STEP 0: INPUT PARAMETERS & VALIDATING THEM\r",
		"        */\r",
		"        if (errStatus && errMsg.length > 0) {\r",
		"\r",
		"            result = {\r",
		"                statusFlag: 'F',\r",
		"                message: 'The following parameters are required for Salary Offer computation -- \\n' + errMsg.toString()\r",
		"            }\r",
		"\r",
		"            complete();\r",
		"            return;\r",
		"\r",
		"        }\r",
		"\r",
		"\r",
		"        /*\r",
		"        additional check if yearsDiff is a valid number\r",
		"        if not, return here\r",
		"        */\r",
		"\r",
		"        if (isNaN(yearsDiff)) {\r",
		"\r",
		"            result = {\r",
		"                statusFlag: 'F',\r",
		"                message: 'Difference of Years of Experience must not be a valid Number'\r",
		"            }\r",
		"\r",
		"            complete();\r",
		"            return;\r",
		"\r",
		"        }\r",
		"\r",
		"        let jsonObj = {\r",
		"            \"name\": \"GSHR_SALARY_OFFER_RULE\",\r",
		"            \"attributes\": [\r",
		"                {\r",
		"                    \"name\": \"yearsDiff\",\r",
		"                    \"type\": \"number\"\r",
		"                },\r",
		"                {\r",
		"                    \"name\": \"hireType\",\r",
		"                    \"type\": \"string\"\r",
		"                }\r",
		"            ],\r",
		"            \"decisions\": [\r",
		"                {\r",
		"                    \"conditions\": {\r",
		"                        \"all\": [\r",
		"                            {\r",
		"                                \"fact\": \"yearsDiff\",\r",
		"                                \"operator\": \"lessThan\",\r",
		"                                \"value\": -2\r",
		"                            },\r",
		"                            {\r",
		"                                \"fact\": \"hireType\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": \"EXTERNAL\"\r",
		"                            }\r",
		"                        ]\r",
		"                    },\r",
		"                    \"event\": {\r",
		"                        \"type\": \"SALARY_OFFER\",\r",
		"                        \"params\": {\r",
		"                            \"minTgtOffer\": \"40\",\r",
		"                            \"tgtOffer\": \"50\",\r",
		"                            \"maxTgtOffer\": \"55\"\r",
		"                        }\r",
		"                    }\r",
		"                },\r",
		"                {\r",
		"                    \"conditions\": {\r",
		"                        \"all\": [\r",
		"                            {\r",
		"                                \"fact\": \"yearsDiff\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": -2\r",
		"                            },\r",
		"                            {\r",
		"                                \"fact\": \"hireType\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": \"EXTERNAL\"\r",
		"                            }\r",
		"                        ]\r",
		"                    },\r",
		"                    \"event\": {\r",
		"                        \"type\": \"SALARY_OFFER\",\r",
		"                        \"params\": {\r",
		"                            \"minTgtOffer\": \"75\",\r",
		"                            \"tgtOffer\": \"80\",\r",
		"                            \"maxTgtOffer\": \"85\"\r",
		"                        }\r",
		"                    }\r",
		"                },\r",
		"                {\r",
		"                    \"conditions\": {\r",
		"                        \"all\": [\r",
		"                            {\r",
		"                                \"fact\": \"yearsDiff\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": -1\r",
		"                            },\r",
		"                            {\r",
		"                                \"fact\": \"hireType\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": \"EXTERNAL\"\r",
		"                            }\r",
		"                        ]\r",
		"                    },\r",
		"                    \"event\": {\r",
		"                        \"type\": \"SALARY_OFFER\",\r",
		"                        \"params\": {\r",
		"                            \"minTgtOffer\": \"80\",\r",
		"                            \"tgtOffer\": \"85\",\r",
		"                            \"maxTgtOffer\": \"90\"\r",
		"                        }\r",
		"                    }\r",
		"                },\r",
		"                {\r",
		"                    \"conditions\": {\r",
		"                        \"all\": [\r",
		"                            {\r",
		"                                \"fact\": \"yearsDiff\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": 0\r",
		"                            },\r",
		"                            {\r",
		"                                \"fact\": \"hireType\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": \"EXTERNAL\"\r",
		"                            }\r",
		"                        ]\r",
		"                    },\r",
		"                    \"event\": {\r",
		"                        \"type\": \"SALARY_OFFER\",\r",
		"                        \"params\": {\r",
		"                            \"minTgtOffer\": \"85\",\r",
		"                            \"tgtOffer\": \"90\",\r",
		"                            \"maxTgtOffer\": \"95\"\r",
		"                        }\r",
		"                    }\r",
		"                },\r",
		"                {\r",
		"                    \"conditions\": {\r",
		"                        \"all\": [\r",
		"                            {\r",
		"                                \"fact\": \"yearsDiff\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": 1\r",
		"                            },\r",
		"                            {\r",
		"                                \"fact\": \"hireType\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": \"EXTERNAL\"\r",
		"                            }\r",
		"                        ]\r",
		"                    },\r",
		"                    \"event\": {\r",
		"                        \"type\": \"SALARY_OFFER\",\r",
		"                        \"params\": {\r",
		"                            \"minTgtOffer\": \"90\",\r",
		"                            \"tgtOffer\": \"95\",\r",
		"                            \"maxTgtOffer\": \"99\"\r",
		"                        }\r",
		"                    }\r",
		"                },\r",
		"                {\r",
		"                    \"conditions\": {\r",
		"                        \"all\": [\r",
		"                            {\r",
		"                                \"fact\": \"yearsDiff\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": 2\r",
		"                            },\r",
		"                            {\r",
		"                                \"fact\": \"hireType\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": \"EXTERNAL\"\r",
		"                            }\r",
		"                        ]\r",
		"                    },\r",
		"                    \"event\": {\r",
		"                        \"type\": \"SALARY_OFFER\",\r",
		"                        \"params\": {\r",
		"                            \"minTgtOffer\": \"95\",\r",
		"                            \"tgtOffer\": \"99\",\r",
		"                            \"maxTgtOffer\": \"101\"\r",
		"                        }\r",
		"                    }\r",
		"                },\r",
		"                {\r",
		"                    \"conditions\": {\r",
		"                        \"all\": [\r",
		"                            {\r",
		"                                \"fact\": \"yearsDiff\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": 3\r",
		"                            },\r",
		"                            {\r",
		"                                \"fact\": \"hireType\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": \"EXTERNAL\"\r",
		"                            }\r",
		"                        ]\r",
		"                    },\r",
		"                    \"event\": {\r",
		"                        \"type\": \"SALARY_OFFER\",\r",
		"                        \"params\": {\r",
		"                            \"minTgtOffer\": \"99\",\r",
		"                            \"tgtOffer\": \"105\",\r",
		"                            \"maxTgtOffer\": \"110\"\r",
		"                        }\r",
		"                    }\r",
		"                },\r",
		"                {\r",
		"                    \"conditions\": {\r",
		"                        \"all\": [\r",
		"                            {\r",
		"                                \"fact\": \"yearsDiff\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": 4\r",
		"                            },\r",
		"                            {\r",
		"                                \"fact\": \"hireType\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": \"EXTERNAL\"\r",
		"                            }\r",
		"                        ]\r",
		"                    },\r",
		"                    \"event\": {\r",
		"                        \"type\": \"SALARY_OFFER\",\r",
		"                        \"params\": {\r",
		"                            \"minTgtOffer\": \"99\",\r",
		"                            \"tgtOffer\": \"105\",\r",
		"                            \"maxTgtOffer\": \"110\"\r",
		"                        }\r",
		"                    }\r",
		"                },\r",
		"                {\r",
		"                    \"conditions\": {\r",
		"                        \"all\": [\r",
		"                            {\r",
		"                                \"fact\": \"yearsDiff\",\r",
		"                                \"operator\": \"greaterThan\",\r",
		"                                \"value\": 4\r",
		"                            },\r",
		"                            {\r",
		"                                \"fact\": \"hireType\",\r",
		"                                \"operator\": \"equal\",\r",
		"                                \"value\": \"EXTERNAL\"\r",
		"                            }\r",
		"                        ]\r",
		"                    },\r",
		"                    \"event\": {\r",
		"                        \"type\": \"SALARY_OFFER\",\r",
		"                        \"params\": {\r",
		"                            \"minTgtOffer\": \"110\",\r",
		"                            \"tgtOffer\": \"120\",\r",
		"                            \"maxTgtOffer\": \"130\"\r",
		"                        }\r",
		"                    }\r",
		"                }\r",
		"            ]\r",
		"        };\r",
		"\r",
		"        //Rule engine code\r",
		"        /*\r",
		"        creating a variable Engine that will be used as a constructor\r",
		"        */\r",
		"        const Engine = modules.jsonrulesengine.Engine;\r",
		"\r",
		"\r",
		"        /*\r",
		"        STEP 1: computing the response from the RULE ENGINE\r",
		"        */\r",
		"        //function to return the o/p values based on the inputs\r",
		"        function processEngine(inputs, decisions) {\r",
		"\r",
		"            //intialize a new engine\r",
		"            const engine = new Engine(decisions);\r",
		"\r",
		"            //passing the input to the above engine & mathcing up with the decisions\r",
		"            return engine.run(inputs)\r",
		"                .then(results => {\r",
		"                    //console.log(results.events)\r",
		"                    return results.events\r",
		"                })\r",
		"\r",
		"        }\r",
		"\r",
		"\r",
		"\r",
		"\r",
		"        /*\r",
		"        testing with inputs\r",
		"        inputs coming from API request body\r",
		"        */\r",
		"        const res = await processEngine({ yearsDiff: yearsDiff, hireType: hireType }, jsonObj.decisions);\r",
		"\r",
		"\r",
		"        if (Array.isArray(res) && res.length !== 1) {\r",
		"\r",
		"            result = {\r",
		"                statusFlag: 'F',\r",
		"                message: `<insert message here>`\r",
		"            }\r",
		"\r",
		"            log.info(`[OSS_FETCH_SALARY_OFFER] script execution -- Salary offer fetched -- ${res.length}`)\r",
		"            complete();\r",
		"            return;\r",
		"\r",
		"        }\r",
		"\r",
		"        let item = res[res.length - 1];\r",
		"\r",
		"    \r",
		"        result = {\r",
		"\r",
		"            statusFlag: 'S',\r",
		"            type: item.type,\r",
		"\r",
		"            dataResponse: [\r",
		"                {\r",
		"                    minTgtOffer: (item.params.minTgtOffer / 100) * avgSalary,\r",
		"                    tgtOffer: (item.params.tgtOffer / 100) * avgSalary,\r",
		"                    maxTgtOffer: (item.params.maxTgtOffer / 100) * avgSalary\r",
		"                }\r",
		"            ],\r",
		"\r",
		"            /*\r",
		"            minTgtSalOffer: (item.params.minTgtOffer / 100) * avgSalary, //min target salary offer\r",
		"            tgtSalOffer: (item.params.tgtOffer / 100) * avgSalary, //target salary offer\r",
		"            maxTgtSalOffer: (item.params.maxTgtOffer / 100) * avgSalary, //max target salary offer\r",
		"            */\r",
		"\r",
		"            //currencyCode: s.currencycode, //local currency code\r",
		"\r",
		"            queryMsg: 'operation completed in ' + ((Date.now() - startTime) / 1000) + ' seconds'\r",
		"\r",
		"        }\r",
		"        log.info(`[OSS_FETCH_SALARY_OFFER] script executed by computing the following salary offer of ${JSON.stringify(result)} based on YD: ${yearsDiff} and HT: ${hireType}`);\r",
		"\r",
		"\r",
		"        complete();\r",
		"\r",
		"\r",
		"    } catch (err) {\r",
		"\r",
		"        result = {\r",
		"            statusFlag: 'F',\r",
		"            message: `system was unable to fetch the salary offers due to -- ${err}.`\r",
		"        }\r",
		"        log.error(`[OSS_FETCH_SALARY_OFFER] script execution failed due to ${err}`)\r",
		"        complete();\r",
		"    }\r",
		"\r",
		"\r",
		"\r",
		"\r",
		"}\r",
		"\r",
		"\r",
		"fetch_salary_offer();"
	],
	"useAsGlobalScript": false,
	"isTypescript": false,
	"transpiledContent": null,
	"lastRunSuccessful": true,
	"jsscriptGroup": "5d1f1d76-58c4-435d-8ca3-67cdbfb841f9",
	"package": "fe88e924-8026-406a-ab72-68f20486b107"
}